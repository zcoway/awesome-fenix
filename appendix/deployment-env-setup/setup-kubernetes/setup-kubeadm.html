<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 Kubeadm 部署 | 凤凰架构</title>
    <meta name="description" content="构建可靠的大型分布式系统">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.b81ab54c.css" as="style"><link rel="preload" href="/assets/js/app.96611671.js" as="script"><link rel="preload" href="/assets/js/3.80e781dc.js" as="script"><link rel="preload" href="/assets/js/6.614ff9eb.js" as="script"><link rel="preload" href="/assets/js/31.fc4b6c57.js" as="script"><link rel="preload" href="/assets/js/48.ac31b718.js" as="script"><link rel="prefetch" href="/assets/js/1.6cc55eb6.js"><link rel="prefetch" href="/assets/js/10.08d1e4c6.js"><link rel="prefetch" href="/assets/js/100.8d1b87f9.js"><link rel="prefetch" href="/assets/js/101.1a1c540d.js"><link rel="prefetch" href="/assets/js/102.ad8669cb.js"><link rel="prefetch" href="/assets/js/103.3638d776.js"><link rel="prefetch" href="/assets/js/104.2c08727a.js"><link rel="prefetch" href="/assets/js/105.ed7d12f0.js"><link rel="prefetch" href="/assets/js/106.67a54d9c.js"><link rel="prefetch" href="/assets/js/107.a5442e23.js"><link rel="prefetch" href="/assets/js/108.f2036232.js"><link rel="prefetch" href="/assets/js/109.30a1d961.js"><link rel="prefetch" href="/assets/js/11.bd0bdd48.js"><link rel="prefetch" href="/assets/js/110.53488311.js"><link rel="prefetch" href="/assets/js/111.0cde12ec.js"><link rel="prefetch" href="/assets/js/112.27950326.js"><link rel="prefetch" href="/assets/js/113.c7e56d9d.js"><link rel="prefetch" href="/assets/js/114.394c0b6d.js"><link rel="prefetch" href="/assets/js/115.6bb2872e.js"><link rel="prefetch" href="/assets/js/116.0c8607ae.js"><link rel="prefetch" href="/assets/js/117.c62127a9.js"><link rel="prefetch" href="/assets/js/118.bf8a3497.js"><link rel="prefetch" href="/assets/js/119.5f2fd611.js"><link rel="prefetch" href="/assets/js/12.f06a53fd.js"><link rel="prefetch" href="/assets/js/120.9d152489.js"><link rel="prefetch" href="/assets/js/121.95e7866f.js"><link rel="prefetch" href="/assets/js/122.ab9fc28d.js"><link rel="prefetch" href="/assets/js/123.a260121b.js"><link rel="prefetch" href="/assets/js/124.406d1ddc.js"><link rel="prefetch" href="/assets/js/125.9e5b6763.js"><link rel="prefetch" href="/assets/js/126.fba7b228.js"><link rel="prefetch" href="/assets/js/127.db0f51a1.js"><link rel="prefetch" href="/assets/js/128.ce8eae7c.js"><link rel="prefetch" href="/assets/js/129.ef15bfcf.js"><link rel="prefetch" href="/assets/js/13.9b6bd7ae.js"><link rel="prefetch" href="/assets/js/130.8c4de9f1.js"><link rel="prefetch" href="/assets/js/131.3c6e63c8.js"><link rel="prefetch" href="/assets/js/132.d464cdd6.js"><link rel="prefetch" href="/assets/js/133.68749d97.js"><link rel="prefetch" href="/assets/js/134.506e1868.js"><link rel="prefetch" href="/assets/js/135.3655b45e.js"><link rel="prefetch" href="/assets/js/136.82b900b4.js"><link rel="prefetch" href="/assets/js/137.27978226.js"><link rel="prefetch" href="/assets/js/138.c9c82157.js"><link rel="prefetch" href="/assets/js/139.699a3013.js"><link rel="prefetch" href="/assets/js/14.3470944d.js"><link rel="prefetch" href="/assets/js/140.0547a4ed.js"><link rel="prefetch" href="/assets/js/141.ad65debc.js"><link rel="prefetch" href="/assets/js/142.e1c9d7e5.js"><link rel="prefetch" href="/assets/js/143.a68b88a8.js"><link rel="prefetch" href="/assets/js/144.8472f511.js"><link rel="prefetch" href="/assets/js/145.5bb42880.js"><link rel="prefetch" href="/assets/js/146.817d1789.js"><link rel="prefetch" href="/assets/js/147.114eea7c.js"><link rel="prefetch" href="/assets/js/148.4f15e2f4.js"><link rel="prefetch" href="/assets/js/149.cef275d3.js"><link rel="prefetch" href="/assets/js/15.70fb4fb2.js"><link rel="prefetch" href="/assets/js/150.8854e987.js"><link rel="prefetch" href="/assets/js/151.4558abb6.js"><link rel="prefetch" href="/assets/js/152.7fca8783.js"><link rel="prefetch" href="/assets/js/153.f4739f41.js"><link rel="prefetch" href="/assets/js/154.11d0b96e.js"><link rel="prefetch" href="/assets/js/155.a05821ab.js"><link rel="prefetch" href="/assets/js/156.4f232b12.js"><link rel="prefetch" href="/assets/js/157.304bf11c.js"><link rel="prefetch" href="/assets/js/158.dd342581.js"><link rel="prefetch" href="/assets/js/159.1e70c687.js"><link rel="prefetch" href="/assets/js/16.92dc5104.js"><link rel="prefetch" href="/assets/js/160.414ee32e.js"><link rel="prefetch" href="/assets/js/161.423ba945.js"><link rel="prefetch" href="/assets/js/162.b97b8cc6.js"><link rel="prefetch" href="/assets/js/163.12732e1e.js"><link rel="prefetch" href="/assets/js/164.6a0b30d0.js"><link rel="prefetch" href="/assets/js/165.aeecf2b5.js"><link rel="prefetch" href="/assets/js/166.593b0ae0.js"><link rel="prefetch" href="/assets/js/167.477a2b47.js"><link rel="prefetch" href="/assets/js/168.dd08e4d5.js"><link rel="prefetch" href="/assets/js/169.9548e3cd.js"><link rel="prefetch" href="/assets/js/17.a6e7f478.js"><link rel="prefetch" href="/assets/js/170.be03e286.js"><link rel="prefetch" href="/assets/js/171.39fe87ef.js"><link rel="prefetch" href="/assets/js/172.9bfda63d.js"><link rel="prefetch" href="/assets/js/18.cf034938.js"><link rel="prefetch" href="/assets/js/19.d3951d59.js"><link rel="prefetch" href="/assets/js/20.83b44b91.js"><link rel="prefetch" href="/assets/js/21.f0d639d3.js"><link rel="prefetch" href="/assets/js/22.2736fbb3.js"><link rel="prefetch" href="/assets/js/23.91a69a93.js"><link rel="prefetch" href="/assets/js/24.0589ce77.js"><link rel="prefetch" href="/assets/js/25.53bfcbd5.js"><link rel="prefetch" href="/assets/js/26.7ea66e3e.js"><link rel="prefetch" href="/assets/js/27.9fd50803.js"><link rel="prefetch" href="/assets/js/28.f36ac771.js"><link rel="prefetch" href="/assets/js/29.22c627e5.js"><link rel="prefetch" href="/assets/js/30.6b626ea3.js"><link rel="prefetch" href="/assets/js/32.6f7674c3.js"><link rel="prefetch" href="/assets/js/33.f32eef6c.js"><link rel="prefetch" href="/assets/js/34.e053379d.js"><link rel="prefetch" href="/assets/js/35.2b921187.js"><link rel="prefetch" href="/assets/js/36.a0877bbe.js"><link rel="prefetch" href="/assets/js/37.5b33a5cb.js"><link rel="prefetch" href="/assets/js/38.7e0aceb5.js"><link rel="prefetch" href="/assets/js/39.eef09cb4.js"><link rel="prefetch" href="/assets/js/4.f0944258.js"><link rel="prefetch" href="/assets/js/40.a5cb9a2a.js"><link rel="prefetch" href="/assets/js/41.d3db5036.js"><link rel="prefetch" href="/assets/js/42.3c53e576.js"><link rel="prefetch" href="/assets/js/43.1702d588.js"><link rel="prefetch" href="/assets/js/44.6e2474e8.js"><link rel="prefetch" href="/assets/js/45.40a6eeb3.js"><link rel="prefetch" href="/assets/js/46.88884def.js"><link rel="prefetch" href="/assets/js/47.e1bfebe8.js"><link rel="prefetch" href="/assets/js/49.a11218e9.js"><link rel="prefetch" href="/assets/js/5.57def0f4.js"><link rel="prefetch" href="/assets/js/50.b347f06f.js"><link rel="prefetch" href="/assets/js/51.b28165a8.js"><link rel="prefetch" href="/assets/js/52.83b26e24.js"><link rel="prefetch" href="/assets/js/53.854ebe13.js"><link rel="prefetch" href="/assets/js/54.6f411f79.js"><link rel="prefetch" href="/assets/js/55.ce9d5842.js"><link rel="prefetch" href="/assets/js/56.d8191dbe.js"><link rel="prefetch" href="/assets/js/57.df433e3a.js"><link rel="prefetch" href="/assets/js/58.37eb932e.js"><link rel="prefetch" href="/assets/js/59.0a778b9f.js"><link rel="prefetch" href="/assets/js/60.2c88f9d3.js"><link rel="prefetch" href="/assets/js/61.298ee793.js"><link rel="prefetch" href="/assets/js/62.88bd9010.js"><link rel="prefetch" href="/assets/js/63.8313c412.js"><link rel="prefetch" href="/assets/js/64.0dc86660.js"><link rel="prefetch" href="/assets/js/65.16c9b030.js"><link rel="prefetch" href="/assets/js/66.4ceb2d52.js"><link rel="prefetch" href="/assets/js/67.0a877741.js"><link rel="prefetch" href="/assets/js/68.20d7594b.js"><link rel="prefetch" href="/assets/js/69.09d77f45.js"><link rel="prefetch" href="/assets/js/7.c6f66c12.js"><link rel="prefetch" href="/assets/js/70.9759c198.js"><link rel="prefetch" href="/assets/js/71.a08efaeb.js"><link rel="prefetch" href="/assets/js/72.15742ef1.js"><link rel="prefetch" href="/assets/js/73.a531e91a.js"><link rel="prefetch" href="/assets/js/74.a4dba5e0.js"><link rel="prefetch" href="/assets/js/75.40021a5e.js"><link rel="prefetch" href="/assets/js/76.92be4b08.js"><link rel="prefetch" href="/assets/js/77.ea314bc3.js"><link rel="prefetch" href="/assets/js/78.b23a5aff.js"><link rel="prefetch" href="/assets/js/79.4c3548a8.js"><link rel="prefetch" href="/assets/js/8.7c16dc43.js"><link rel="prefetch" href="/assets/js/80.b7a52b96.js"><link rel="prefetch" href="/assets/js/81.f28e06cd.js"><link rel="prefetch" href="/assets/js/82.09e29315.js"><link rel="prefetch" href="/assets/js/83.cb5c764a.js"><link rel="prefetch" href="/assets/js/84.56dbc272.js"><link rel="prefetch" href="/assets/js/85.8d107be9.js"><link rel="prefetch" href="/assets/js/86.0bdd0704.js"><link rel="prefetch" href="/assets/js/87.61f38ee3.js"><link rel="prefetch" href="/assets/js/88.da89e45c.js"><link rel="prefetch" href="/assets/js/89.072b5fb7.js"><link rel="prefetch" href="/assets/js/9.4ba47508.js"><link rel="prefetch" href="/assets/js/90.5ad4c67a.js"><link rel="prefetch" href="/assets/js/91.ff4e6e50.js"><link rel="prefetch" href="/assets/js/92.4f18b617.js"><link rel="prefetch" href="/assets/js/93.59474cef.js"><link rel="prefetch" href="/assets/js/94.0eaf89ca.js"><link rel="prefetch" href="/assets/js/95.2e4d56ee.js"><link rel="prefetch" href="/assets/js/96.da072ad4.js"><link rel="prefetch" href="/assets/js/97.ffcaea5b.js"><link rel="prefetch" href="/assets/js/98.19fcea47.js"><link rel="prefetch" href="/assets/js/99.9523d6b2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b81ab54c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo-color.png" alt="凤凰架构" class="logo"> <span class="site-name can-hide">凤凰架构</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board/" class="nav-link">
  讨论区
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board/" class="nav-link">
  讨论区
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/summary/" class="sidebar-link">目录</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/about-me.html" class="sidebar-link">关于作者</a></li><li><a href="/introduction/about-book.html" class="sidebar-link">关于纸质书</a></li><li><a href="/introduction/about-the-fenix-project.html" class="sidebar-link">什么是“凤凰架构”</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>探索起步</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>阅读指引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/changelog/" class="sidebar-link">更新日志</a></li><li><a href="/exploration/guide/quick-start.html" class="sidebar-link">如何开始</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/exploration/projects/" class="sidebar-heading clickable"><span>技术演示工程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/exploration/projects/fenix-bookstore-frontend.html" class="sidebar-link">前端工程</a></li><li><a href="/exploration/projects/monolithic_arch_springboot.html" class="sidebar-link">单体架构：Spring Boot</a></li><li><a href="/exploration/projects/microservice_arch_springcloud.html" class="sidebar-link">微服务：Spring Cloud</a></li><li><a href="/exploration/projects/microservice_arch_kubernetes.html" class="sidebar-link">微服务：Kubernetes</a></li><li><a href="/exploration/projects/servicemesh_arch_istio.html" class="sidebar-link">服务网格：Istio</a></li><li><a href="/exploration/projects/serverless_arch.html" class="sidebar-link">无服务：AWS Lambda</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>演进中的架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architecture/architect-history/" class="sidebar-heading clickable open"><span>服务架构演进史</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/architect-history/primitive-distribution.html" class="sidebar-link">原始分布式时代</a></li><li><a href="/architecture/architect-history/monolithic.html" class="sidebar-link">单体系统时代</a></li><li><a href="/architecture/architect-history/soa.html" class="sidebar-link">SOA 时代</a></li><li><a href="/architecture/architect-history/microservices.html" class="sidebar-link">微服务时代</a></li><li><a href="/architecture/architect-history/post-microservices.html" class="sidebar-link">后微服务时代</a></li><li><a href="/architecture/architect-history/serverless.html" class="sidebar-link">无服务时代</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构师的视角</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/api-style/" class="sidebar-heading clickable open"><span>访问远程服务</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/api-style/rpc.html" class="sidebar-link">远程服务调用</a></li><li><a href="/architect-perspective/general-architecture/api-style/rest.html" class="sidebar-link">REST 设计风格</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/transaction/" class="sidebar-heading clickable"><span>事务处理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/transaction/local.html" class="sidebar-link">本地事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/global.html" class="sidebar-link">全局事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/share.html" class="sidebar-link">共享事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/distributed.html" class="sidebar-link">分布式事务</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/diversion-system/" class="sidebar-heading clickable"><span>透明多级分流系统</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/diversion-system/client-cache.html" class="sidebar-link">客户端缓存</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/dns-lookup.html" class="sidebar-link">域名解析</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/transmission-optimization.html" class="sidebar-link">传输链路</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cdn.html" class="sidebar-link">内容分发网络</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/load-balancing.html" class="sidebar-link">负载均衡</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cache-middleware.html" class="sidebar-link">服务端缓存</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/system-security/" class="sidebar-heading clickable"><span>架构安全性</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/system-security/authentication.html" class="sidebar-link">认证</a></li><li><a href="/architect-perspective/general-architecture/system-security/authorization.html" class="sidebar-link">授权</a></li><li><a href="/architect-perspective/general-architecture/system-security/credentials.html" class="sidebar-link">凭证</a></li><li><a href="/architect-perspective/general-architecture/system-security/confidentiality.html" class="sidebar-link">保密</a></li><li><a href="/architect-perspective/general-architecture/system-security/transport-security.html" class="sidebar-link">传输</a></li><li><a href="/architect-perspective/general-architecture/system-security/verification.html" class="sidebar-link">验证</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式的基石</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/consensus/" class="sidebar-heading clickable open"><span>分布式共识算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/consensus/paxos.html" class="sidebar-link">Paxos</a></li><li><a href="/distribution/consensus/raft.html" class="sidebar-link">Multi Paxos</a></li><li><a href="/distribution/consensus/gossip.html" class="sidebar-link">Gossip 协议</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/connect/" class="sidebar-heading clickable"><span>从类库到服务</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/connect/service-discovery.html" class="sidebar-link">服务发现</a></li><li><a href="/distribution/connect/service-routing.html" class="sidebar-link">网关路由</a></li><li><a href="/distribution/connect/load-balancing.html" class="sidebar-link">客户端负载均衡</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/traffic-management/" class="sidebar-heading clickable"><span>流量治理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/traffic-management/failure.html" class="sidebar-link">服务容错</a></li><li><a href="/distribution/traffic-management/traffic-control.html" class="sidebar-link">流量控制</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/secure/" class="sidebar-heading clickable"><span>可靠通讯</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/secure/zero-trust.html" class="sidebar-link">零信任网络</a></li><li><a href="/distribution/secure/service-security.html" class="sidebar-link">服务安全</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/observability/" class="sidebar-heading clickable"><span>可观测性</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/observability/logging.html" class="sidebar-link">事件日志</a></li><li><a href="/distribution/observability/tracing.html" class="sidebar-link">链路追踪</a></li><li><a href="/distribution/observability/metrics.html" class="sidebar-link">聚合度量</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>不可变基础设施</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/msa-to-cn.html" class="sidebar-link">从微服务到云原生</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/container/" class="sidebar-heading clickable"><span>虚拟化容器</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/container/history.html" class="sidebar-link">容器的崛起</a></li><li><a href="/immutable-infrastructure/container/container-build-system.html" class="sidebar-link">以容器构建系统</a></li><li><a href="/immutable-infrastructure/container/application-centric.html" class="sidebar-link">以应用为中心的封装</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/network/" class="sidebar-heading clickable"><span>容器间网络</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/network/linux-vnet.html" class="sidebar-link">Linux 网络虚拟化</a></li><li><a href="/immutable-infrastructure/network/cni.html" class="sidebar-link">容器网络与生态</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/storage/" class="sidebar-heading clickable"><span>持久化存储</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/storage/storage-evolution.html" class="sidebar-link">Kubernetes 存储设计</a></li><li><a href="/immutable-infrastructure/storage/csi.html" class="sidebar-link">容器存储与生态</a></li></ul></section></li><li><a href="/immutable-infrastructure/schedule/hardware-schedule.html" class="sidebar-link">资源与调度</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/mesh/" class="sidebar-heading clickable"><span>服务网格</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/mesh/communication.html" class="sidebar-link">透明通信的涅槃</a></li><li><a href="/immutable-infrastructure/mesh/ecosystems.html" class="sidebar-link">服务网格与生态</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术方法论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/methodology/forward-msa/" class="sidebar-heading clickable open"><span>向微服务迈进</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/methodology/forward-msa/objective.html" class="sidebar-link">目的：微服务的驱动力</a></li><li><a href="/methodology/forward-msa/prerequest.html" class="sidebar-link">前提：微服务需要的条件</a></li><li><a href="/methodology/forward-msa/granularity.html" class="sidebar-link">边界：微服务的粒度</a></li><li><a href="/methodology/forward-msa/governance.html" class="sidebar-link">治理：理解系统复杂性</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>随笔文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>2020年</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/tricks/2020/graalvm/" class="sidebar-heading clickable open"><span>Graal VM</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tricks/2020/graalvm/graal-compiler.html" class="sidebar-link">新一代即时编译器</a></li><li><a href="/tricks/2020/graalvm/substratevm.html" class="sidebar-link">向原生迈进</a></li><li><a href="/tricks/2020/graalvm/graalvm-native.html" class="sidebar-link">没有虚拟机的 Java</a></li><li><a href="/tricks/2020/graalvm/spring-over-graal.html" class="sidebar-link">Spring over Graal</a></li></ul></section></li><li><a href="/tricks/2020/java-crisis/qcon.html" class="sidebar-link">QCon2020 主题演讲：云原生时代，Java 的危与机</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>2021年</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tricks/2021/openjdk-for-dummies/" class="sidebar-link">OpenJDK with CLion 懒人包</a></li><li><a href="/tricks/2021/geekbang.html" class="sidebar-link">程序员之路</a></li><li><a href="/tricks/2021/fenix-cli/" class="sidebar-link">Fenix-CLI：交互式云原生客户端</a></li><li><a href="/tricks/2021/arch/" class="sidebar-link">ArchSummit2021主题演讲：从软件的历史看架构的未来</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>附录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/appendix/deployment-env-setup/" class="sidebar-heading clickable router-link-active open"><span>部署环境</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/deployment-env-setup/setup-docker.html" class="sidebar-link">部署 Docker CE 容器环境</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/appendix/deployment-env-setup/setup-kubernetes/" class="sidebar-heading clickable router-link-active open"><span>部署Kubernetes集群</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html" class="active sidebar-link">使用 Kubeadm 部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#注册-apt-软件源" class="sidebar-link">注册 apt 软件源</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#安装-kubelet、kubectl、kubeadm" class="sidebar-link">安装 kubelet、kubectl、kubeadm</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#初始化集群前的准备" class="sidebar-link">初始化集群前的准备</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#预拉取镜像" class="sidebar-link">预拉取镜像</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#初始化集群控制平面" class="sidebar-link">初始化集群控制平面</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#为当前用户生成-kubeconfig" class="sidebar-link">为当前用户生成 kubeconfig</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#安装-cni-插件" class="sidebar-link">安装 CNI 插件</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#移除-master-节点上的污点" class="sidebar-link">移除 Master 节点上的污点</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#调整-nodeport-范围" class="sidebar-link">调整 NodePort 范围</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#启用-kubectl-命令自动补全功能" class="sidebar-link">启用 kubectl 命令自动补全功能</a></li><li class="sidebar-sub-header"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-kubeadm.html#将其他-node-节点加入到-kubernetes-集群中" class="sidebar-link">将其他 Node 节点加入到 Kubernetes 集群中</a></li></ul></li><li><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-rancher.html" class="sidebar-link">使用 Rancher 部署</a></li><li><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-minikube.html" class="sidebar-link">使用 Minikube 部署</a></li></ul></section></li></ul></section></li><li><a href="/appendix/istio.html" class="sidebar-link">部署 Istio</a></li><li><a href="/appendix/operation-env-setup/elk-setup.html" class="sidebar-link">部署 Elastic Stack</a></li><li><a href="/appendix/operation-env-setup/prometheus-setup.html" class="sidebar-link">部署 Prometheus</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用-kubeadm-部署">使用 Kubeadm 部署</h1> <p>尽管使用 Rancher 或者 KubeSphere 这样更高层次的管理工具，可以更“傻瓜式”地部署和管理 Kubernetes 集群，但 kubeadm 作为官方提供的用于快速安装 Kubernetes 的命令行工具，仍然是一项应该掌握的基础技能。kubeadm 随着新版的 Kubernetes 同步更新，时效性也会比其他更高层次的管理工具来的更好。现在 kubeadm 无论是部署单控制平面（Single Control Plane，单 Master 节点）集群还是高可用（High Availability，多 Master 节点）集群，都已经有了很优秀的易用性，手工部署 Kubernetes 集群已经不是什么太复杂、困难的事情了。本文以 Debian 系的 Linux 为例，介绍通过 kubeadm 部署集群的全过程。</p> <div class="custom-block tip"><p class="custom-block-title">注意事项</p> <ol><li>安装 Kubernetes 集群，需要从谷歌的仓库中拉取镜像，由于国内访问谷歌的网络受阻，需要通过科学上网或者在 Docker 中预先拉取好所需镜像等方式解决。</li> <li>集群中每台机器的 Hostname 不要重复，否则 Kubernetes 从不同机器收集状态信息时会产生干扰，被认为是同一台机器。</li> <li>安装 Kubernetes 最小需要 2 核处理器、2 GB 内存，且为 x86 架构（暂不支持 ARM 架构）。对于物理机器来说，今时今日要找一台<strong>不满足</strong>以上条件的机器很困难，但对于云主机来说，尤其是囊中羞涩、只购买了云计算厂商中最低配置的同学，就要注意一下是否达到了最低要求，不清楚的话请在<code>/proc/cpuinf</code>、<code>/proc/meminfo</code>中确认一下。</li> <li>确保网络通畅的——这听起来像是废话，但确实有相当一部分的云主机不对 SELinux、iptables、安全组、防火墙进行设置的话，内网各个节点之间、与外网之间会存在默认的访问障碍，导致部署失败。
:::</li></ol> <h2 id="注册-apt-软件源">注册 apt 软件源</h2> <p>由于 Kubernetes 并不在主流 Debian 系统自带的软件源中，所以要手工注册，然后才能使用<code>apt-get</code>安装。</p> <p>官方的 GPG Key 地址为：<a href="https://packages.cloud.google.com/apt/doc/apt-key.gpg" target="_blank" rel="noopener noreferrer">https://packages.cloud.google.com/apt/doc/apt-key.gpg<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，其中包括的软件源的地址为：<a href="https://apt.kubernetes.io/" target="_blank" rel="noopener noreferrer">https://apt.kubernetes.io/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（该地址最终又会被重定向至：<a href="https://packages.cloud.google.com/apt/" target="_blank" rel="noopener noreferrer">https://packages.cloud.google.com/apt/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。如果能访问 google.com 域名的机器，采用以下方法注册 apt 软件源是最佳的方式：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 添加GPG Key</span>
$ <span class="token function">sudo</span> <span class="token function">curl</span> -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -

<span class="token comment"># 添加K8S软件源</span>
$ <span class="token function">sudo</span> add-apt-repository <span class="token string">&quot;deb https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span>
</code></pre></div><p>对于不能访问 google.com 的机器，就要借助国内的镜像源来安装了。虽然在这些镜像源中我已遇到过不止一次同步不及时的问题了——就是官方源中已经发布了软件的更新版本，而镜像源中还是旧版的，除了时效性问题外，还出现过其他的一些一致性问题，但是总归比没有的强。国内常见用的 apt 源有阿里云的、中科大的等，具体为：</p> <blockquote><p>阿里云：</p> <ul><li>GPG Key：<a href="http://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg" target="_blank" rel="noopener noreferrer">http://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>软件源：<a href="http://mirrors.aliyun.com/kubernetes/apt" target="_blank" rel="noopener noreferrer">http://mirrors.aliyun.com/kubernetes/apt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>中科大：</p> <ul><li>GPG Key：<a href="https://raw.githubusercontent.com/EagleChen/kubernetes_init/master/kube_apt_key.gpg" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/EagleChen/kubernetes_init/master/kube_apt_key.gpg<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>软件源：<a href="http://mirrors.ustc.edu.cn/kubernetes/apt" target="_blank" rel="noopener noreferrer">http://mirrors.ustc.edu.cn/kubernetes/apt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote> <p>它们的使用方式与官方源注册过程是一样的，只需替换里面的 GPG Key 和软件源的 URL 地址即可，譬如阿里云：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 添加GPG Key</span>
$ <span class="token function">curl</span> -fsSL http://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -

<span class="token comment"># 添加K8S软件源</span>
$ <span class="token function">sudo</span> add-apt-repository <span class="token string">&quot;deb http://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main&quot;</span>
</code></pre></div><p>添加源后记得执行一次更新：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre></div><h2 id="安装-kubelet、kubectl、kubeadm">安装 kubelet、kubectl、kubeadm</h2> <p>并不需要在每个节点都装上 kubectl，但都装上也无不可。下面简要列出了这三个工具/组件的作用，现在看不看得懂都没有关系，以后用到它们的机会多得是，要相信日久总会生情的。</p> <ul><li>kubeadm: 引导启动 Kubernate 集群的命令行工具。</li> <li>kubelet: 在群集中的所有计算机上运行的组件, 并用来执行如启动 Pods 和 Containers 等操作。</li> <li>kubectl: 用于操作运行中的集群的命令行工具。</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> kubelet kubeadm kubectl
</code></pre></div><h2 id="初始化集群前的准备">初始化集群前的准备</h2> <p>在使用 kubeadm 初始化集群之前，还有一些必须的前置工作要妥善处理：</p> <p>首先，基于安全性（如在官方文档中承诺的 Secret 只会在内存中读写，不会落盘）、利于保证节点同步一致性等原因，从 1.8 版开始，Kubernetes 就在它的文档中明确声明了它默认<strong>不支持</strong>Swap 分区，在未关闭 Swap 分区的机器中，集群将直接无法启动。关闭 Swap 的命令为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> swapoff -a
</code></pre></div><p>上面这个命令是一次性的，只在当前这次启动中生效，要彻底关闭 Swap 分区，需要在文件系统分区表的配置文件中去直接除掉 Swap 分区。你可以使用文本编辑器打开<code>/etc/fstab</code>，注释其中带有“swap”的行即可，或使用以下命令直接完成修改：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 还是先备份一下</span>
$ <span class="token function">yes</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">cp</span> /etc/fstab /etc/fstab_bak

<span class="token comment"># 进行修改</span>
$ <span class="token function">sudo</span> <span class="token function">cat</span> /etc/fstab_bak <span class="token operator">|</span> <span class="token function">grep</span> -v swap <span class="token operator">&gt;</span> /etc/fstab
</code></pre></div><blockquote><p><strong>可选操作</strong></p> <p>当然，在服务器上使用的话，关闭 Swap 影响还是很大的，如果服务器除了 Kubernetes 还有其他用途的话（除非实在太穷，否则建议不要这样混用；一定要混用的话，宁可把其他服务搬到 Kubernetes 上）。关闭 Swap 有可能会对其他服务产生不良的影响，这时需要修改每个节点的 kubelet 配置，去掉必须关闭 Swap 的默认限制，具体操作为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;KUBELET_EXTRA_ARGS=--fail-swap-on=false&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/sysconfig/kubelet
</code></pre></div></blockquote> <p>其次，由于 Kubernetes 与 Docker 默认的 cgroup（资源控制组）驱动程序并不一致，Kubernetes 默认为<code>systemd</code>，而 Docker 默认为<code>cgroupfs</code>。</p> <p>在这里我们要修改 Docker 或者 Kubernetes 其中一个的 cgroup 驱动，以便两者统一。根据官方文档《<a href="https://kubernetes.io/docs/setup/cri/" target="_blank" rel="noopener noreferrer">CRI installation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>》中的建议，对于使用 systemd 作为引导系统的 Linux 的发行版，使用 systemd 作为 Docker 的 cgroup 驱动程序可以服务器节点在资源紧张的情况表现得更为稳定。</p> <p>这里选择修改各个节点上 Docker 的 cgroup 驱动为<code>systemd</code>，具体操作为编辑（无则新增）<code>/etc/docker/daemon.json</code>文件，加入以下内容即可：</p> <div class="language-text extra-class"><pre class="language-text"><code>{
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
}
</code></pre></div><p>然后重新启动 Docker 容器：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ systemctl daemon-reload
$ systemctl restart docker
</code></pre></div><h2 id="预拉取镜像">预拉取镜像 <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>可选</span></h2> <p>预拉取镜像并不是必须的，本来初始化集群的时候系统就会自动拉取 Kubernetes 中要使用到的 Docker 镜像组件，也提供了一个<code>kubeadm config images pull</code>命令来一次性的完成拉取，这都是因为如果要手工来进行这项工作，实在非常非常非常地繁琐。</p> <p>但对于许多人来说这项工作往往又是无可奈何的，Kubernetes 的镜像都存储在 k8s.gcr.io 上，如果您的机器无法直接或通过代理访问到 gcr.io（Google Container Registry。笔者敲黑板：这也是属于谷歌的网址）的话，初始化集群时自动拉取就无法顺利进行，所以就不得不手工预拉取。</p> <p>预拉取的意思是，由于 Docker 只要查询到本地有相同（名称和 tag 完全相同、哈希相同）的镜像，就不会访问远程仓库，那只要从 GitHub 上拉取到所需的镜像，再将 tag 修改成官方的一致，就可以跳过网络访问阶段。</p> <p>首先使用以下命令查询当前版本需要哪些镜像：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubeadm config images list --kubernetes-version v1.17.3

k8s.gcr.io/kube-apiserver:v1.17.3
k8s.gcr.io/kube-controller-manager:v1.17.3
k8s.gcr.io/kube-scheduler:v1.17.3
k8s.gcr.io/kube-proxy:v1.17.3
k8s.gcr.io/pause:3.1
k8s.gcr.io/etcd:3.4.3-0
k8s.gcr.io/coredns:1.6.5
……
</code></pre></div><p>这里必须使用<code>--kubernetes-version</code>参数指定具体版本，因为尽管每个版本需要的镜像信息在本地是有存储的，但如果不加的话，Kubernetes 将向远程 GCR 仓库查询最新的版本号，会因网络无法访问而导致问题。但加版本号的时候切记不能照抄上面的命令中的“v1.17.3”，应该与你安装的 kubelet 版本保持一致，否则在初始化集群控制平面的时候会提示控制平面版本与 kubectl 版本不符。</p> <p>得到这些镜像名称和 tag 后，可以从<a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">DockerHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上找存有相同镜像的仓库来拉取，至于具体哪些公开仓库有，考虑到以后阅读本文时 Kubernetes 的版本应该会有所差别，所以需要自行到DockerHub网站上查询一下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#以k8s.gcr.io/coredns:1.6.5为例，每个镜像都要这样处理一次</span>
$ docker pull anjia0532/google-containers.coredns:1.6.5

<span class="token comment">#修改tag</span>
$ docker tag anjia0532/google-containers.coredns:1.6.5 k8s.gcr.io/coredns:1.6.5

<span class="token comment">#修改完tag后就可以删除掉旧镜像了</span>
$ docker rmi anjia0532/google-containers.coredns:1.6.5
</code></pre></div><h2 id="初始化集群控制平面">初始化集群控制平面</h2> <p>到了这里，终于可以开始 Master 节点的部署了，先确保 kubelet 是开机启动的：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> systemctl start kubelet
$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> kubelet
</code></pre></div><p>接下来使用 su 直接切换到 root 用户（而不是使用 sudo），然后使用以下命令开始部署：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubeadm init <span class="token punctuation">\</span>
  --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 <span class="token punctuation">\</span>
  --kubernetes-version v1.17.3 <span class="token punctuation">\</span>
  --apiserver-advertise-address <span class="token operator">&lt;</span>NET_INTERFACE_IP<span class="token operator">&gt;</span>
</code></pre></div><p>这里解释一下使用这几个参数的原因：</p> <p><code>--kubernetes-version</code>参数（要注意版本号与 kubelet 一致）的目的是与前面预拉取是一样的，避免额外的网络访问去查询版本号；如果能够科学上网，不需要加这个参数。</p> <p><code>--pod-network-cidr</code>参数是给Flannel网络做网段划分使用的，着在稍后介绍完 CNI 网络插件时会去说明。</p> <p><code>--apiserver-advertise-address</code>参数是APIServer的IP地址，如果有多张物理网卡，建议指定明确的IP地址来建立Kubernetes集群。因为CA证书直接与地址相关，Kubernetes中诸多配置（配置文件、ConfigMap资源）也直接存储了这个地址，一旦更换IP，要想要不重置集群，手工换起来异常麻烦。</p> <p>命令执行完毕，当看到下面信息之后，说明集群主节点已经安装完毕了。</p> <div class="custom-block center"><p><img src="/assets/img/kubernetes-initialized.7c7ddc17.png" alt=""></p></div></div> <p>这信息先恭喜你已经把控制平面安装成功了，但还有三行“you need……”、“you should……”、“you can……”开头的内容，这是三项后续的“可选”工作，下面继续介绍。</p> <h2 id="为当前用户生成-kubeconfig">为当前用户生成 kubeconfig</h2> <p>使用 Kubernetes 前需要为当前用户先配置好 admin.conf 文件。切换至需配置的用户后，进行如下操作：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
$ <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
$ <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre></div><h2 id="安装-cni-插件">安装 CNI 插件 <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>可选</span></h2> <p>CNI 即“容器网络接口”，在 2016 年，CoreOS 发布了 CNI 规范。2017 年 5 月，CNI 被 CNCF 技术监督委员会投票决定接受为托管项目，从此成为不同容器编排工具（Kubernetes、Mesos、OpenShift）可以共同使用的、解决容器之间网络通讯的统一接口规范。</p> <p>部署 Kubernetes 时，我们可以有两种网络方案使得以后受管理的容器之间进行网络通讯：</p> <ul><li>使用 Kubernetes 的默认网络</li> <li>使用 CNI 及其插件</li></ul> <p>第一种方案，尤其不在 GCP 或者 AWS 的云主机上，没有它们的命令行管理工具时，需要大量的手工配置，基本上是反人类的。实际通常都会采用第二种方案，使用 CNI 插件来处理容器之间的网络通讯，所以本节虽然标识了“可选”，但其实也并没什么选择不安装 CNI 插件的余地。</p> <p>Kubernetes 目前支持的 CNI 插件有：Calico、Cilium、Contiv-VPP、Flannel、Kube-router、Weave Net 等多种，每种网络提供了不同的管理特性（如 MTU 自动检测）、安全特性（如是否支持网络层次的安全通讯）、网络策略（如 Ingress、Egress 规则）、传输性能（甚至对 TCP、UDP、HTTP、FTP、SCP 等不同协议来说也有不同的性能表现）以及主机的性能消耗。如果你还需要阅读本文来部署 Kubernetes 环境的话，那不用纠结了，直接使用 Flannel 是较为合适的，它是最精简的 CNI 插件之一，没有安全特性的支持，主机压力小，安装便捷，效率也不错，使用以下命令安装 Flannel 网络：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> --insecure -sfL https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml <span class="token operator">|</span> kubectl apply -f -
</code></pre></div><p>使用 Flannel 的话，要注意要在创建集群时加入<code>--pod-network-cidr</code>参数，指明网段划分。如果你是跟着本文去部署的话，这个操作之前已经包含了。</p> <h2 id="移除-master-节点上的污点">移除 Master 节点上的污点 <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>可选</span></h2> <p>污点（Taint）是 Kubernetes Pod 调度中的概念，在这里通俗地理解就是 Kubernetes 决定在集群中的哪一个节点建立新的容器时，要先排除掉带有特定污点的节点，以避免容器在 Kubernetes 不希望运行的节点中创建、运行。默认情况下，集群的 Master 节点是会带有特定污点的，以避免容器分配到 Master 中创建。但对于许多学习 Kubernetes 的同学来说，并没有多么宽裕的机器数量，往往是建立单节点集群或者最多只有两、三个节点，这样 Master 节点不能运行容器就显得十分浪费了。如需移除掉 Master 节点上所有的污点，在 Master 节点上执行以下命令即可：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre></div><p>做到这步，如果你只有一台机器的话，那 Kubernetes 的安装已经宣告结束了，可以使用此环境来完成后续所有的部署。你还可以通过<code>cluster-info</code>和<code>get nodes</code>子命令来查看一下集群的状态，类似如下所示：</p> <div class="custom-block center"><p><img src="/assets/img/kubernetes-setup-completed.08416ad7.png" alt=""></p></div> <h2 id="调整-nodeport-范围">调整 NodePort 范围 <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>可选</span></h2> <p>Kubernetes 默认的 NodePort 范围为 30000-32767，如果你是在测试环境，集群前端没有专门布置负载均衡器的话，那就经常需要通过 NodePort 来访问服务，这样限制了只能使用 30000 以上的端口，虽然能避免冲突，但并不够方便。为了方便使用低端口，可能需要修改此范围，这需要调整 Api-Server 的启动参数，具体操作如下（如过是高可用部署，需要对每一个 Master 节点进行修改）：</p> <ul><li><p>修改<code>/etc/kubernetes/manifests/kube-apiserver.yaml</code>文件，添加一个参数在<code>spec.containers.command</code>中增加一个参数<code>--service-node-port-range=1-32767</code></p></li> <li><p>重启 Api-Server，现在 Kubernetes 基本都是以静态 Pods 模式部署，Api-Server 是一个直接由 kubelet 控制的静态 Pod，删除后它会自动重启：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 获得 apiserver 的 pod 名字</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">apiserver_pods</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get pods --selector<span class="token operator">=</span>component<span class="token operator">=</span>kube-apiserver -n kube-system --output<span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token punctuation">{</span>.items<span class="token punctuation">..</span>metadata.name<span class="token punctuation">}</span><span class="token variable">)</span></span>
<span class="token comment"># 删除 apiserver 的 pod</span>
kubectl delete pod <span class="token variable">$apiserver_pods</span> -n kube-system
</code></pre></div></li> <li><p>验证修改结果：可以在 pod 中看到该参数即可</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl describe pod <span class="token variable">$apiserver_pods</span> -n kube-system
</code></pre></div></li></ul> <h2 id="启用-kubectl-命令自动补全功能">启用 kubectl 命令自动补全功能 <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>可选</span></h2> <p>由于 kubectl 命令在后面十分常用，而且 Kubernetes 许多资源名称都带有随机字符，要手工照着敲很容易出错，强烈推荐启用命令自动补全的功能，这里仅以 bash 和笔者常用的 zsh 为例，如果您使用其他 shell，需自行调整：</p> <blockquote><p>bash：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'source &lt;(kubectl completion bash)'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
$ <span class="token builtin class-name">echo</span> <span class="token string">'source /usr/share/bash-completion/bash_completion'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre></div><p>zsh：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'source &lt;(kubectl completion zsh)'</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">!</span>/.zshrc
</code></pre></div></blockquote> <h2 id="将其他-node-节点加入到-kubernetes-集群中">将其他 Node 节点加入到 Kubernetes 集群中</h2> <p>在安装 Master 节点时候，输出的最后一部分内容会类似如下所示：</p> <div class="language-text extra-class"><pre class="language-text"><code>Then you can join any number of worker nodes by running the following on each as root:

  kubeadm join 10.3.7.5:6443 --token ejg4tt.y08moym055dn9i32 \
    --discovery-token-ca-cert-hash sha256:9d2079d2844fa2953d33cc0da57ab15f571e974aa40ccb50edde12c5e906d513
</code></pre></div><p>这部分内容是告诉用户，集群的 Master 节点已经建立完毕，其他节点的机器可以使用“kubeadm join”命令加入集群。这些机器只要完成 kubeadm、kubelet、kubectl 的安装即可、其他的所有步骤，如拉取镜像、初始化集群等，都不需要去做，就是可以使用该命令加入集群了。需要注意的是，该 Token 的有效时间为 24 小时，如果超时，使用以下命令重新获取：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubeadm token create --print-join-command
</code></pre></div></div> <footer class="page-edit"><!----> <div class="git-hub-star"><span class="prefix">
      Kudos to
      <span style="position:relative;top:4px;right:-4px;"><a href="https://github.com/fenixsoft/awesome-fenix" aria-label="Star fenixsoft/awesome-fenix on GitHub" data-icon="octicon-star" data-show-count="true">
      Star
    </a></span></span></div> <div class="last-updated"><span class="prefix">总字数:</span> <span class="words">4,445</span> <span class="prefix">字　</span> <span class="prefix">最后更新:</span> <span class="time">2/27/2022, 11:55:01 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
    ←
    <a href="/appendix/deployment-env-setup/setup-kubernetes/" class="prev router-link-active">
      部署Kubernetes集群
    </a></span> <span class="next"><a href="/appendix/deployment-env-setup/setup-kubernetes/setup-rancher.html">
      使用 Rancher 部署
    </a>
    →
  </span></p></div> </main></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.96611671.js" defer></script><script src="/assets/js/3.80e781dc.js" defer></script><script src="/assets/js/6.614ff9eb.js" defer></script><script src="/assets/js/31.fc4b6c57.js" defer></script><script src="/assets/js/48.ac31b718.js" defer></script>
  </body>
</html>
