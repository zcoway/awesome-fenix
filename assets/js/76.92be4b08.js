(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{574:function(t,s,a){"use strict";a.r(s);var e=a(11),v=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"部署-istio"}},[t._v("部署 Istio")]),t._v(" "),a("p",[t._v("在 Istio 官方文档上提供了"),a("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/install/istioctl/",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过 Istioctl 安装"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/install/helm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过 Helm 安装"),a("OutboundLink")],1),t._v("和"),a("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/install/standalone-operator/",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过 Operator 安装"),a("OutboundLink")],1),t._v("三种方式，其中，基于 Helm 方式在 Istio 1.5 版之后已被废弃，Operator 方式目前仍处于实验阶段，本文选择采用 Istioctl 方式进行安装。")]),t._v(" "),a("h2",{attrs:{id:"获取-istio"}},[t._v("获取 Istio")]),t._v(" "),a("p",[t._v("首先访问"),a("a",{attrs:{href:"https://github.com/istio/istio/releases/tag/1.7.3",target:"_blank",rel:"noopener noreferrer"}},[t._v("Istio release"),a("OutboundLink")],1),t._v("页面下载与你操作系统匹配的安装文件。在 macOS 或 Linux 系统中，也可以通过以下命令直接下载最新版本的 Istio：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -L https://istio.io/downloadIstio "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" -\n")])])]),a("p",[t._v("解压后，安装目录包括以下内容：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("目录")]),t._v(" "),a("th",[t._v("包含内容")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("bin")])]),t._v(" "),a("td",[t._v("包含 istioctl 的客户端文件")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("install")])]),t._v(" "),a("td",[t._v("包含 Consul、GCP 和 Kubernetes 平台的 Istio 安装脚本和文件")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("samples")])]),t._v(" "),a("td",[t._v("包含示例应用程序")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("tools")])]),t._v(" "),a("td",[t._v("包含用于性能测试和在本地机器上进行测试的脚本")])])])]),t._v(" "),a("p",[t._v("将"),a("code",[t._v("bin")]),t._v("目录下的"),a("code",[t._v("istioctl")]),t._v("客户端路径增加到"),a("code",[t._v("path")]),t._v("环境变量中，macOS 或 Linux 系统的增加方式如下：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PWD")]),t._v("/bin:"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n")])])]),a("p",[t._v("如果你在使用 bash 或 ZSH 的话，可以选择启动"),a("a",{attrs:{href:"https://istio.io/latest/zh/docs/ops/diagnostic-tools/istioctl#enabling-auto-completion",target:"_blank",rel:"noopener noreferrer"}},[t._v("Auto Completion Option"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"默认安装-istio"}},[t._v("默认安装 Istio")]),t._v(" "),a("p",[t._v("部署 Istio，最简单的方式是安装 "),a("code",[t._v("default")]),t._v(" 配置文件，直接使用以下命令即可：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl manifest "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),a("p",[t._v("此命令将在你的 Kubernetes 集群上安装"),a("code",[t._v("default")]),t._v("配置文件。"),a("code",[t._v("default")]),t._v("配置文件建立生产环境的良好起点，这与旨在评估广泛的 Istio 功能特性的较大的"),a("code",[t._v("demo")]),t._v("配置文件不同。各种不同配置文件之间的差异如下表所示：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("default")]),t._v(" "),a("th",[t._v("demo")]),t._v(" "),a("th",[t._v("minimal")]),t._v(" "),a("th",[t._v("sds")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("核心组件")]),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-citadel")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-egressgateway")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-galley")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-ingressgateway")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-nodeagent")])]),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-pilot")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-policy")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-sidecar-injector")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-telemetry")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])]),t._v(" "),a("tr",[a("td",[t._v("插件")]),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("grafana")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("istio-tracing")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kiali")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("prometheus")])]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td",[t._v("X")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("X")])])])]),t._v(" "),a("p",[t._v("安装"),a("code",[t._v("default")]),t._v("配置文件后，如果需要其他组件或者插件，可以进行独立安装。譬如要在"),a("code",[t._v("default")]),t._v("配置文件之上启用 Grafana Dashboard，用下面的命令设置"),a("code",[t._v("addonComponents.grafana.enabled")]),t._v("参数即可：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl manifest "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --set addonComponents.grafana.enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),a("h2",{attrs:{id:"安装-demo-配置"}},[t._v("安装 demo 配置")]),t._v(" "),a("p",[a("code",[t._v("demo")]),t._v("这个词语可能会让使用者产生误解，其实 Istio 的"),a("code",[t._v("demo")]),t._v("配置是默认安装所有组件的全功能配置，从上面表格中配置与组件的对应情况中可以印证这一点。你可以使用以下"),a("code",[t._v("istioctl")]),t._v("命令来列出 Istio 配置文件名称：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl profile list\nIstio configuration profiles:\n    remote\n    separate\n    default\n    demo\n    empty\n    minimal\n")])])]),a("p",[t._v("通过在命令行上设置配置文件名称安装其他 Istio 配置文件到群集中，使用以下命令安装"),a("code",[t._v("demo")]),t._v("配置文件：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl manifest "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --set "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("profile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("demo\n")])])]),a("h2",{attrs:{id:"验证安装成功"}},[t._v("验证安装成功")]),t._v(" "),a("p",[t._v("你可以使用"),a("code",[t._v("verify-install")]),t._v("命令检查 Istio 安装是否成功，它将集群上的安装与你指定的清单进行比较。")]),t._v(" "),a("p",[t._v("如果未在部署之前生成清单，请运行以下命令以现在生成它：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl manifest generate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("your original installation options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/generated-manifest.yaml\n")])])]),a("p",[t._v("然后运行以下"),a("code",[t._v("verify-install")]),t._v("命令以查看安装是否成功：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl verify-install -f "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/generated-manifest.yaml\n")])])]),a("h2",{attrs:{id:"卸载-istio"}},[t._v("卸载 Istio")]),t._v(" "),a("p",[t._v("可以使用以下命令来卸载 Istio：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ istioctl manifest generate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("your original installation options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" kubectl delete -f -\n")])])])])}),[],!1,null,null,null);s.default=v.exports}}]);